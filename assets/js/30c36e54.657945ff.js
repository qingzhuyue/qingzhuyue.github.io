"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4607],{3905:(e,t,n)=>{n.d(t,{Zo:()=>i,kt:()=>k});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},i=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},f=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,i=u(e,["components","mdxType","originalType","parentName"]),p=c(n),f=o,k=p["".concat(l,".").concat(f)]||p[f]||d[f]||r;return n?a.createElement(k,s(s({ref:t},i),{},{components:n})):a.createElement(k,s({ref:t},i))}));function k(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,s=new Array(r);s[0]=f;var u={};for(var l in t)hasOwnProperty.call(t,l)&&(u[l]=t[l]);u.originalType=e,u[p]="string"==typeof e?e:o,s[1]=u;for(var c=2;c<r;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}f.displayName="MDXCreateElement"},496:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>u,toc:()=>c});var a=n(7462),o=(n(7294),n(3905));const r={sidebar_position:8,slug:"React\uff1aHooks\u5de5\u4f5c\u673a\u5236",title:"React\uff1aHooks\u5de5\u4f5c\u673a\u5236",tags:["react"]},s=void 0,u={permalink:"/react/React\uff1aHooks\u5de5\u4f5c\u673a\u5236",source:"@site/react/react202308.md",title:"React\uff1aHooks\u5de5\u4f5c\u673a\u5236",description:"\x3c!--",date:"2023-02-19T14:01:20.000Z",formattedDate:"2023\u5e742\u670819\u65e5",tags:[{label:"react",permalink:"/react/tags/react"}],readingTime:9.875,hasTruncateMarker:!1,authors:[],frontMatter:{sidebar_position:8,slug:"React\uff1aHooks\u5de5\u4f5c\u673a\u5236",title:"React\uff1aHooks\u5de5\u4f5c\u673a\u5236",tags:["react"]},prevItem:{title:"Redux\u57fa\u672c\u4f7f\u7528\u548c\u5b9e\u8df5",permalink:"/react/Redux\u57fa\u672c\u4f7f\u7528\u548c\u5b9e\u8df5"},nextItem:{title:"React\uff1a\u5408\u6210\u4e8b\u4ef6",permalink:"/react/React\uff1a\u5408\u6210\u4e8b\u4ef6"}},l={authorsImageUrls:[]},c=[{value:"Hooks\u89c4\u5219",id:"hooks\u89c4\u5219",level:2},{value:"Hooks\u673a\u5236",id:"hooks\u673a\u5236",level:2},{value:"useState\u521d\u6b21\u6e32\u67d3",id:"usestate\u521d\u6b21\u6e32\u67d3",level:3},{value:"useState\u66f4\u65b0\u6e32\u67d3",id:"usestate\u66f4\u65b0\u6e32\u67d3",level:3},{value:"useEffect\u521d\u6b21\u6e32\u67d3",id:"useeffect\u521d\u6b21\u6e32\u67d3",level:3},{value:"useEffect\u66f4\u65b0\u9636\u6bb5",id:"useeffect\u66f4\u65b0\u9636\u6bb5",level:3},{value:"useRef",id:"useref",level:3},{value:"useMemo &amp; useCallback",id:"usememo--usecallback",level:3}],i={toc:c};function p(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},i,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"hooks\u89c4\u5219"},"Hooks\u89c4\u5219"),(0,o.kt)("p",null,"React Hooks\u7684\u4f7f\u7528\uff0c\u6709\u4e24\u4e2a\u89c4\u5219\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Hooks\u53ea\u80fd\u5728\u51fd\u6570\u7ec4\u4ef6\u4e2d\u4f7f\u7528\uff1b"),(0,o.kt)("li",{parentName:"ol"},"\u4e0d\u80fd\u5728\u6761\u4ef6\u3001\u5faa\u73af\u6216\u8005\u5d4c\u5957\u51fd\u6570\u4e2d\u4f7f\u7528hook\u3002\u786e\u4fdd\u6bcf\u4e00\u6b21\u6e32\u67d3\u4e2d\u90fd\u6309\u7167\u540c\u6837\u7684\u987a\u5e8f\u88ab\u8c03\u7528\uff0c")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'import React, { useState } from "react";\nexport default function PersonalInfoComponent() {\n  const [name, setName] = useState("\u8bfb\u5fc3\u60a6");\n  const [career, setCareer] = useState("\u524d\u7aef");\n  return (\n    <div className="personalInfo">\n      <p>\u59d3\u540d\uff1a{name}</p>\n      <p>\u804c\u4e1a\uff1a{career}</p>\n      <button\n        onClick={() => {\n          setName("duxinyues");\n        }}\n      >\n        \u4fee\u6539\u59d3\u540d\n      </button>\n    </div>\n  );\n}\n')),(0,o.kt)("p",null,"\u8fd9\u4e00\u6bb5\u4ee3\u7801\u4e2d\u7684hook\u662f\u6309\u7167\u6b63\u5e38\u7684\u987a\u5e8f\u6765\u6267\u884c\u7684\uff0c\u73b0\u5728\u628ahook\u653e\u5230\u6761\u4ef6\u8bed\u53e5\u4e2d\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'import React, { useState } from "react";\n\nlet isMounted = false;\nexport default function PersonalInfoComponent() {\n  let name,  career, setName;\n  console.log("isMounted", isMounted);\n\n  if (!isMounted) {\n    // eslint-disable-next-line\n    [name, setName] = useState("\u8bfb\u5fc3\u60a6");\n    // if \u5185\u90e8\u7684\u903b\u8f91\u6267\u884c\u4e00\u6b21\u540e\uff0c\u5c31\u5c06 isMounted \u7f6e\u4e3a true\uff08\u8bf4\u660e\u5df2\u6302\u8f7d\uff0c\u540e\u7eed\u90fd\u4e0d\u518d\u662f\u9996\u6b21\u6e32\u67d3\u4e86\uff09\n    isMounted = true;\n  }\n  [career] = useState("\u524d\u7aef\u5f00\u53d1");\n  console.log("career", career);\n\n  return (\n    <div className="personalInfo">\n      <p>\u59d3\u540d\uff1a{name}</p>\n     \n      <p>\u804c\u4e1a\uff1a{career}</p>\n      <button\n        onClick={() => {\n          setName("duxinyues");\n        }}\n      >\n        \u4fee\u6539\u59d3\u540d\n      </button>\n    </div>\n  );\n}\n')),(0,o.kt)("p",null,"\u8fd9\u6bb5\u4ee3\u7801\uff0c\u5728\u9996\u6b21\u6e32\u67d3\u7684\u65f6\u5019\uff0c\u662f\u53ef\u4ee5\u6b63\u5e38\u663e\u793a\u3002\u5f53\u6211\u4eec\u70b9\u51fb\u4fee\u6539\u6309\u94ae\u540e\uff0creact\u5c31\u4f1a\u63d0\u793a\u62a5\u9519\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://img-blog.csdnimg.cn/53d066d4fdb84aba81a59111bf921dd4.png",alt:"\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0"})),(0,o.kt)("p",null,"\u4ece\u63a7\u5236\u53f0\u4e2d\u770b\u51fa\uff0c\u6211\u4eec\u660e\u660e\u4fee\u6539\u7684\u662fname\uff0c\u6700\u540e\u66f4\u65b0\u7684\u786e\u5b9ecareer\uff0c\u8fd9\u5c31\u662f\u8fdd\u53cd\u89c4\u5219\u7684\u540e\u679c\uff0c\u4f1a\u9020\u6210hooks\u72b6\u6001\u7d0a\u4e71\u3002"),(0,o.kt)("h2",{id:"hooks\u673a\u5236"},"Hooks\u673a\u5236"),(0,o.kt)("p",null,"\u4ece\u6e90\u7801\u4e2d\uff0c\u770b\u4e00hooks\u7684\u6e90\u7801\uff0c\u5176\u4e2d\u6709\u4e00\u4e2aDispatcher\uff0c\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4e0d\u540c\u7684hook\u8c03\u7528\u7684\u51fd\u6570\u4e0d\u540c\u3002\n\u5168\u5c40\u53d8\u91cfReactCurrentDispatcher.current\u7684\u8d4b\u503c\u662f\u901a\u8fc7\u5224\u65ad\u662f\u9996\u6b21\u6e32\u67d3\u8fd8\u662f\u66f4\u65b0\u9636\u6bb5\u8d4b\u4e0d\u540c\u7684\u503c\uff1a"),(0,o.kt)("p",null,"\u6e90\u7801\u6587\u4ef6ReactFiberHooks.old.js"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"    ReactCurrentDispatcher.current =\n      current === null || current.memoizedState === null\n        ? HooksDispatcherOnMount\n        : HooksDispatcherOnUpdate;\n")),(0,o.kt)("p",null,"hooks\u5728\u9996\u6b21\u6e32\u67d3\u548c\u66f4\u65b0\u9636\u6bb5\u662f\u6267\u884c\u4e0d\u540c\u7684\u903b\u8f91\u3002"),(0,o.kt)("p",null,"HooksDispatcherOnMount\u4ee3\u7801\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const HooksDispatcherOnMount: Dispatcher = {\n  readContext,\n\n  useCallback: mountCallback,\n  useContext: readContext,\n  useEffect: mountEffect,\n  useImperativeHandle: mountImperativeHandle,\n  useLayoutEffect: mountLayoutEffect,\n  useInsertionEffect: mountInsertionEffect,\n  useMemo: mountMemo,\n  useReducer: mountReducer,\n  useRef: mountRef,\n  useState: mountState,\n  useDebugValue: mountDebugValue,\n  useDeferredValue: mountDeferredValue,\n  useTransition: mountTransition,\n  useMutableSource: mountMutableSource,\n  useSyncExternalStore: mountSyncExternalStore,\n  useslug: mountId,\n\n  unstable_isNewReconciler: enableNewReconciler,\n};\n")),(0,o.kt)("p",null,"HooksDispatcherOnUpdate\u4ee3\u7801\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const HooksDispatcherOnUpdate: Dispatcher = {\n  readContext,\n\n  useCallback: updateCallback,\n  useContext: readContext,\n  useEffect: updateEffect,\n  useImperativeHandle: updateImperativeHandle,\n  useInsertionEffect: updateInsertionEffect,\n  useLayoutEffect: updateLayoutEffect,\n  useMemo: updateMemo,\n  useReducer: updateReducer,\n  useRef: updateRef,\n  useState: updateState,\n  useDebugValue: updateDebugValue,\n  useDeferredValue: updateDeferredValue,\n  useTransition: updateTransition,\n  useMutableSource: updateMutableSource,\n  useSyncExternalStore: updateSyncExternalStore,\n  useslug: updateId,\n\n  unstable_isNewReconciler: enableNewReconciler,\n};\n")),(0,o.kt)("h3",{id:"usestate\u521d\u6b21\u6e32\u67d3"},"useState\u521d\u6b21\u6e32\u67d3"),(0,o.kt)("p",null,"\u5148\u770b\u4e00\u4e0buseState\u7684\u6e90\u7801\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"export function useState<S>(\n  initialState: (() => S) | S,\n): [S, Dispatch<BasicStateAction<S>>] {\n  const dispatcher = resolveDispatcher();\n  return dispatcher.useState(initialState);\n}\n")),(0,o.kt)("p",null,"\u5728\u6e90\u7801\u4e2d\u5b9a\u4e49\u6bd4\u8f83\u7b80\u5355\uff0c\u5148\u83b7\u53d6\u5f53\u524d\u7684dispatcher\uff0c\u518d\u8ffd\u6eaf\u5230resolveDispatcher\u65b9\u6cd5\uff0c\u5b83\u7684\u6e90\u7801\u4e3a\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function resolveDispatcher() {\n  const dispatcher = ReactCurrentDispatcher.current;\n  if (__DEV__) {\n    if (dispatcher === null) {\n     ....\n  }\n  return ((dispatcher: any): Dispatcher);\n}\n")),(0,o.kt)("p",null,"useState\u5728\u9996\u6b21\u6e32\u67d3\uff0c\u6267\u884c\u7684\u662fHooksDispatcherOnMount.useState\uff0c\u4e5f\u5c31\u662fmountState\u65b9\u6cd5\u3002\u518d\u6765\u770b\u4e00\u4e0bmountState\u51fd\u6570\u7684\u6e90\u7801\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function mountState<S>(\n  initialState: (() => S) | S,\n): [S, Dispatch<BasicStateAction<S>>] {\n  // \u5c06hook\u8ffd\u52a0\u5230\u94fe\u8868\u5c3e\u90e8\n  const hook = mountWorkInProgressHook();\n  if (typeof initialState === 'function') {\n    // initialState\u662f\u56de\u8c03\u51fd\u6570\u7684\u6216=\u8bdd\uff0c\u5c31\u83b7\u53d6\u56de\u8c03\u51fd\u6570\u6267\u884c\u7684\u8fd4\u56de\u503c\n    initialState = initialState();\n  }\n  // \u628ainitialState\u4fdd\u5b58\u4e0b\u6765\n  hook.memoizedState = hook.baseState = initialState;\n  const queue: UpdateQueue<S, BasicStateAction<S>> = {\n    pending: null,\n    interleaved: null,\n    lanes: NoLanes, // \u4f18\u5148\u7ea7\n    dispatch: null,\n    lastRenderedReducer: basicStateReducer,\n    lastRenderedState: (initialState: any),\n  };\n  hook.queue = queue;\n  const dispatch: Dispatch<\n    BasicStateAction<S>,\n  > = (queue.dispatch = (dispatchSetState.bind(\n    null,\n    currentlyRenderingFiber,\n    queue,\n  ): any));\n  return [hook.memoizedState, dispatch];\n}\n")),(0,o.kt)("p",null,"mountState\u51fd\u6570\u4e3b\u8981\u662f\u4e3a\u4e86\u521d\u59cb\u5316hook\u3002\u518d\u4ecemountWorkInProgressHook\u65b9\u6cd5\u4e2d\uff0c\u4e86\u89e3\u4e00\u4e0bhook\u7684\u6570\u636e\u7ed3\u6784\u3002\u6e90\u7801\u5982\u4e0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function mountWorkInProgressHook(): Hook {\n  const hook: Hook = {\n    memoizedState: null, // \u4e0d\u540c\u7684hook\uff0c\u6709\u4e0d\u540c\u7684\u503c\n\n    baseState: null, // \u521d\u59cbstate\n    baseQueue: null, // \u521d\u59cb\u961f\u5217\n    queue: null, // \u9700\u8981\u66f4\u65b0\u7684\u961f\u5217\n\n    next: null, // \u4e0b\u4e00\u4e2ahook\n  };\n\n  if (workInProgressHook === null) {\n    // This is the first hook in the list\n    currentlyRenderingFiber.memoizedState = workInProgressHook = hook;\n  } else {\n    // Append to the end of the list\n    workInProgressHook = workInProgressHook.next = hook;\n  }\n  return workInProgressHook;\n}\n")),(0,o.kt)("p",null,"hook\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u662f\u4fdd\u5b58\u5728\u4e00\u4e2a\u5bf9\u8c61\u4e2d\uff0chook\u5bf9\u8c61\u4e4b\u95f4\u662f\u4ee5\u5355\u5411\u94fe\u8868\u7684\u5f62\u5f0f\u8fde\u63a5\u3002hook\u5219\u662f\u4fdd\u5b58\u5728Fiber\u7684memoizedState\u4e0a\uff0c\u9700\u8981\u66f4\u65b0\u7684\u662f\u4fdd\u5b58\u5728hook.queue.pending\u4e2d\u3002"),(0,o.kt)("p",null,"\u73b0\u5728\u53ef\u4ee5\u770b\u51fa\uff0c\u7ec4\u4ef6\u6240\u6709\u7684hook\u4e4b\u95f4\u662f\u4ee5\u5355\u5411\u94fe\u8868\u5f62\u5f0f\u4e32\u8054\uff0c\u73af\u73af\u76f8\u6263\u3002\u5982\u679c\u94fe\u8868\u4e0a\u7684\u67d0\u4e00\u4e2ahook\u4e22\u5931\u4e86\uff0c\u90a3\u4e48\u94fe\u8868\u7684\u987a\u5e8f\u5c31\u53d1\u751f\u53d8\u5316\uff0c\u94fe\u8868\u4e0a\u7684hook\u4e0e\u4e4b\u524d\u5c31\u4e0d\u80fd\u610f\u4e49\u5bf9\u5e94\uff0c\u4ece\u800c\u5bfc\u81f4hook\u72b6\u6001\u7d0a\u4e71\u3002"),(0,o.kt)("h3",{id:"usestate\u66f4\u65b0\u6e32\u67d3"},"useState\u66f4\u65b0\u6e32\u67d3"),(0,o.kt)("p",null,"\u5728\u66f4\u65b0\u9636\u6bb5\uff0c\u4f7f\u7528\u7684dispatcher\u662fHooksDispatcherOnUpdate\u3002\u6211\u4eec\u5728\u7ec4\u4ef6\u66f4\u65b0\u7684\u65f6\u5019\uff0c\u8c03\u7528\u7684\u662fuseState\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5728\u8c03\u7528HooksDispatcherOnUpdate.useState\uff0c\u4e5f\u5c31\u662fupdateState\u65b9\u6cd5\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function updateState<S>(\n  initialState: (() => S) | S,\n): [S, Dispatch<BasicStateAction<S>>] {\n  return updateReducer(basicStateReducer, (initialState: any));\n}\n")),(0,o.kt)("p",null,"\u5728\u6e90\u7801\u4e2d\uff0cuseState\u548cuseReducer\u662f\u590d\u7528\u4e00\u5957\u66f4\u65b0\u673a\u5236\uff0c\u7531\u4e8euseReducer\u7684\u4ee3\u7801\u6709\u70b9\u591a\uff0c\u5c31\u4e0d\u8d34\u51fa\u6765\u4e86\u3002"),(0,o.kt)("p",null,"updateState\u5c31\u662f\u6309\u7167\u987a\u5e8f\u904d\u5386\u4e4b\u524d\u5df2\u7ecf\u6784\u5efa\u597d\u4e86\u7684\u94fe\u8868\uff0c\u53d6\u51fa\u5bf9\u5e94\u7684\u6570\u636e\u4fe1\u606f\u8fdb\u884c\u66f4\u65b0\u3002"),(0,o.kt)("p",null,"\u5c0f\u603b\u7ed3\uff1a\n",(0,o.kt)("inlineCode",{parentName:"p"},"mountState"),"\uff08\u9996\u6b21\u6e32\u67d3\uff09\u6784\u5efa\u94fe\u8868\u5e76\u4e14\u6e32\u67d3\uff1b\n",(0,o.kt)("inlineCode",{parentName:"p"},"updateState"),"\uff08\u66f4\u65b0\u6e32\u67d3\uff09\u4e00\u6b21\u904d\u5386\u94fe\u8868\u5e76\u4e14\u6e32\u67d3\uff1b"),(0,o.kt)("h3",{id:"useeffect\u521d\u6b21\u6e32\u67d3"},"useEffect\u521d\u6b21\u6e32\u67d3"),(0,o.kt)("p",null,"\u6e90\u7801\u4e2duseEffect\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"export function useEffect(\n  create: () => (() => void) | void,\n  deps: Array<mixed> | void | null,\n): void {\n  const dispatcher = resolveDispatcher();\n  return dispatcher.useEffect(create, deps);\n}\n")),(0,o.kt)("p",null,"\u5728\u521d\u6b21\u6e32\u67d3\u7684\u65f6\u5019\uff0c\u8c03\u7528\u7684\u662fmountEffect\uff0cmountEffect\u53c8\u8c03\u7528\u7684\u662fmountEffectImpl\uff0cmountEffectImpl\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function mountEffectImpl(fiberFlags, hookFlags, create, deps): void {\n  const hook = mountWorkInProgressHook(); //\u83b7\u53d6\u94fe\u8868\n  const nextDeps = deps === undefined ? null : deps; // \u4f9d\u8d56\n  currentlyRenderingFiber.flags |= fiberFlags; // \u6dfb\u52a0flag\n  hook.memoizedState = pushEffect(\n    HookHasEffect | hookFlags,\n    create,\n    undefined,\n    nextDeps,\n  );\n}\n")),(0,o.kt)("p",null,"mountEffect\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function mountEffect(\n  create: () => (() => void) | void,\n  deps: Array<mixed> | void | null,\n): void {\n  if (\n    __DEV__ &&\n    enableStrictEffects &&\n    (currentlyRenderingFiber.mode & StrictEffectsMode) !== NoMode\n  ) {\n    return mountEffectImpl(\n      MountPassiveDevEffect | PassiveEffect | PassiveStaticEffect,\n      HookPassive,\n      create,\n      deps,\n    );\n  } else {\n    return mountEffectImpl(\n      PassiveEffect | PassiveStaticEffect,\n      HookPassive,\n      create,\n      deps,\n    );\n  }\n}\n")),(0,o.kt)("p",null,"\u5728\u9996\u6b21\u6e32\u67d3\uff0cuseEffect\u4e5f\u662f\u4fdd\u5b58\u5728hook.memoizedState\u4e0a\u7684\u3002"),(0,o.kt)("h3",{id:"useeffect\u66f4\u65b0\u9636\u6bb5"},"useEffect\u66f4\u65b0\u9636\u6bb5"),(0,o.kt)("p",null,"\u5728\u66f4\u65b0\u9636\u6bb5\uff0c\u8c03\u7528\u7684\u662fupdateEffect\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function updateEffect(\n  create: () => (() => void) | void,\n  deps: Array<mixed> | void | null,\n): void {\n  return updateEffectImpl(PassiveEffect, HookPassive, create, deps);\n}\n\nfunction updateEffectImpl(fiberFlags, hookFlags, create, deps): void {\n  const hook = updateWorkInProgressHook();\n  const nextDeps = deps === undefined ? null : deps;\n  let destroy = undefined;\n\n  if (currentHook !== null) {\n    const prevEffect = currentHook.memoizedState;\n    destroy = prevEffect.destroy;\n    if (nextDeps !== null) {\n      const prevDeps = prevEffect.deps;\n      if (areHookInputsEqual(nextDeps, prevDeps)) {\n        hook.memoizedState = pushEffect(hookFlags, create, destroy, nextDeps);\n        return;\n      }\n    }\n  }\n\n  currentlyRenderingFiber.flags |= fiberFlags;\n\n  hook.memoizedState = pushEffect(\n    HookHasEffect | hookFlags,\n    create,\n    destroy,\n    nextDeps,\n  );\n}\n")),(0,o.kt)("p",null,"\u6d45\u6bd4\u8f83\u4f9d\u8d56\uff0c\u5982\u679c\u4f9d\u8d56\u53d1\u751f\u53d8\u5316\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u91cd\u65b0\u6267\u884c\u4e86\u3002"),(0,o.kt)("h3",{id:"useref"},"useRef"),(0,o.kt)("p",null,"useRef\u5728\u9996\u6b21\u6e32\u67d3\uff0c\u8c03\u7528\u7684\u662fmountRef\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function mountRef<T>(initialValue: T): {|current: T|} {\n    const hook = mountWorkInProgressHook(); // \u83b7\u53d6useRef\n    const ref = {current: initialValue}; //\u521d\u59cb\u5316ref\n    hook.memoizedState = ref;\n    return ref;\n}\n")),(0,o.kt)("p",null,"\u5728render\u7684\u65f6\u5019\uff0c\u5e26\u6709ref\u5c5e\u6027\u7684Fiber\u5c31\u4f1a\u6807\u8bb0\u4e0aRef tag\u3002"),(0,o.kt)("p",null,"\u66f4\u65b0\u9636\u6bb5\u7684\u65f6\u5019\uff0c\u8c03\u7528\u7684\u662fupdateRef\uff0c\u7136\u540e\u8fd4\u56dehook\u94fe\u8868\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function updateRef<T>(initialValue: T): {|current: T|} {\n  const hook = updateWorkInProgressHook();\n  return hook.memoizedState;\n}\n")),(0,o.kt)("h3",{id:"usememo--usecallback"},"useMemo & useCallback"),(0,o.kt)("p",null,"\u9996\u6b21\u6e32\u67d3useCallback\u548cuseMemo\u7684\u6e90\u7801\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function mountMemo<T>(\n  nextCreate: () => T,\n  deps: Array<mixed> | void | null,\n): T {\n  const hook = mountWorkInProgressHook();\n  const nextDeps = deps === undefined ? null : deps;\n  const nextValue = nextCreate();\n  hook.memoizedState = [nextValue, nextDeps];\n  return nextValue;\n}\n\nfunction mountCallback<T>(callback: T, deps: Array<mixed> | void | null): T {\n  const hook = mountWorkInProgressHook();\n  const nextDeps = deps === undefined ? null : deps;\n  hook.memoizedState = [callback, nextDeps];\n  return callback;\n}\n")),(0,o.kt)("p",null,"\u5b83\u4eec\u7684\u533a\u522b\u662f\u5728memoizedState\u4e0a\u5b58\u50a8\u7684\u662fcallback\u8fd8\u662fvalue\u3002"),(0,o.kt)("p",null,"\u66f4\u65b0\u9636\u6bb5\u7684\u6e90\u7801\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function updateMemo<T>(\n  nextCreate: () => T,\n  deps: Array<mixed> | void | null,\n): T {\n  const hook = updateWorkInProgressHook();\n  const nextDeps = deps === undefined ? null : deps;\n  const prevState = hook.memoizedState;\n  if (prevState !== null) {\n    // Assume these are defined. If they're not, areHookInputsEqual will warn.\n    if (nextDeps !== null) {\n      const prevDeps: Array<mixed> | null = prevState[1];\n      if (areHookInputsEqual(nextDeps, prevDeps)) {\n        return prevState[0];\n      }\n    }\n  }\n  const nextValue = nextCreate();\n  hook.memoizedState = [nextValue, nextDeps];\n  return nextValue;\n}\n\nfunction updateCallback<T>(callback: T, deps: Array<mixed> | void | null): T {\n  const hook = updateWorkInProgressHook();\n  const nextDeps = deps === undefined ? null : deps;\n  const prevState = hook.memoizedState;\n  if (prevState !== null) {\n    if (nextDeps !== null) {\n      const prevDeps: Array<mixed> | null = prevState[1];\n      if (areHookInputsEqual(nextDeps, prevDeps)) {\n        return prevState[0];\n      }\n    }\n  }\n  hook.memoizedState = [callback, nextDeps];\n  return callback;\n}\n")),(0,o.kt)("p",null,"\u8fd9\u5c31\u662f\u5e38\u7528\u5230\u7684hooks\u7684\u6e90\u7801\u4ee5\u53ca\u7b80\u5355\u89e3\u6790\u3002"))}p.isMDXComponent=!0}}]);